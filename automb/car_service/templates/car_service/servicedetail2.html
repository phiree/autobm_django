{% extends "car_service/base.html" %}
{%load staticfiles%}
        {%load get_values_for_property%}
{%block head%}
<link href="{%static 'car_service/css/detail.css'%}" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="{%static 'car_service/jquery/plugin/jquery.cookie.js'%}"></script>
<script type="text/javascript" src="{%static 'car_service/js/detail.js'%}"></script>
<script>
    $(function(){
        $("#hi_service_id").val("{{detail.pk}}");
        $(".selected,.not_selected").click(function(e){
            var siblings=$(this).siblings('.selected,.not_selected');
            if(siblings.length==0)
            {
                return false;
            }
            else
            {
                 $(siblings).attr('class','not_selected');
                 $(this).attr('class','selected');
            }
            //if(foil_type)
            if($(this).attr('t_id').indexOf('brand')==0)
            {

            }
            //get price
            var service_list=$.parseJSON('{{json_detail_list|safe}}');
            var selected_items=$('.selected');
            var parameters={};
            for(i=0;i< selected_items.length;i++)
            {
                var item=$(selected_items[i]);
                parameters[item.attr('t_id').split('__')[0]]=item.attr('t_id').split('__')[1]

            }
            pushed_list=[];
            search_service(service_list,parameters);
            if(pushed_list.length==1)
            {

                $("#hi_service_id").val(pushed_list[0].pk);
                $("#price").text(pushed_list[0].fields["price"]);
                $("#btn_submit").attr('class','enabled');
            }
            else
            {
                $("#hi_service_id").val(null);
                $("#price").text('-----------');
                $("#btn_submit").attr('class','disabled');
            }
        });

        var pushed_list=[]
        function search_service(service_list, parameters)
        {
            is_empty=true;
            for (var prop in parameters)
            {
            if (parameters.hasOwnProperty(prop))
            {is_empty=false;}
            }
            if(is_empty){return;}

           for(k in service_list)
            {
                var is_match=true;
                service=service_list[k];
                for(key in parameters)
                {

                  if(service['fields'][key][0]+''!=parameters[key])
                  {
                    is_match=false;
                  }
                 }
                 if(is_match)
                 {
                     pushed_list.push(service);
                 }
                  }
            }
});



</script>
{%endblock%}
{%block content%}

<div class="service_item">
    商家:{{service.supplier.name}}
</div>
<div class="service_item">
    服务类型:{{service.servicetype}}
</div>

<div class="service_item">
    服务描述:{{service.description}}
</div>
 {%for p in service.servicetype.serviceproperty_set.all%}
   <div>
       <span>{{p.name}}</span>
       {%for v in p|get_values_for_property:paras%}
       <span>{{v.foiltype}}_{{v.brand}}_{{v.value}}</span>
       {%endfor%}
   </div>
        {%endfor%}

<div>
    <span>价格:</span><span class="" id="price">{{detail.price}}</span>
</div>
            <div>
                <form method="post" action="{%url 'car_service:front_web:bill_create' service.pk %}">
                    {%csrf_token%}
            <input class="submit" type="submit" id="btn_submit">预订</input>
                </form>

        </div>
{%endblock%}
